# 前言

说到卡顿，很多小伙伴的第一反应是不要在主线程进行耗时操作，尽量减小View层级，合理使用include、ViewStub 标签等操作。那么这些操作深层次的原因是什么呢？

# 屏幕刷新原理

我们手机屏幕内容的显示会经过CPU、GPU、DISPLAY 三个部分，CPU负责吧数据计算好交给GPU, GPU会对图形数据进行渲染，然后硬件负责把渲染后的内容呈现到屏幕上，GPU和DISPLAY会不停的协作，将GPU的数据渲染屏幕上。

**屏幕刷新率**

屏幕的显示并不是一蹴而就，而是从左到右或者从上到下顺序显示屏幕上的像素点。不过这个过程非常快人眼是无法识别的。如果屏幕的刷新频率是60hz 那么每次 1000 /60  = 16.666ms

**帧率**

GPU在一秒内绘制操作的帧数，例如30fps，60fps。

当GPU的帧率和屏幕不一致的时候非常容易出现画面撕裂的现象。

![](画面撕裂.jpg)

在这里可以把GPU/CPU看做生产者，DISPLAY看做消费者，GPU/CPU准备好数据，对缓存区域的替换在一瞬间完成，而此时DISPLAY正在显示的过程中，那么上半部分显示的是原来的内容，下半部分就是新替换的内容，这就造成了画面撕裂。

![](GPU_DISPLAY工作.png)

## 双缓冲

双缓冲就是GPU和DISPLAY各自拥有自己的缓冲区域，GPU始终将准备好的数据给到Back Buffer,DISPLAY使用Frame Buffer。在屏幕刷新的过程中Frame Buffer 并不会发生改变，当Back buffer准备好后，他们才能进行交换。

